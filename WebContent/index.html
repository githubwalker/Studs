<!DOCTYPE html>
<html lang="en">
<head>

    <link href="scripts/jquery-ui-1.11.4/jquery-ui.css" rel="stylesheet" type="text/css" />
    <link href="scripts/jtable.2.4.0/themes/metro/blue/jtable.css" rel="stylesheet" type="text/css" />
    <script src="scripts/jquery-2.2.0.js" type="text/javascript"> </script>
    <script src="scripts/jquery-ui-1.11.4/jquery-ui.js" type="text/javascript"> </script>
    <script src="scripts/jtable.2.4.0/jquery.jtable.js" type="text/javascript"></script>

</head>

<body>
<div id="PeopleTableContainer" style="width: 800px;"></div>

<!-- http://www.codeproject.com/Articles/594874/CRUD-tables-in-WebMatrix-using-jTable-jQuery-plugi -->

<script type="text/javascript">

    // https://mindmup.github.io/editable-table/
    // http://stackoverflow.com/questions/8648892/convert-url-parameters-to-a-javascript-object

    function convert2jsonstring( urlparams_string )
    {
        var js_parsed = urlparams_string
                ?
                JSON.parse('{"' + urlparams_string.replace(/&/g, '","').replace(/=/g,'":"') + '"}',
                        function(key, value) { return key===""?value:decodeURIComponent(value) })
                :
        {}
        ;

        return JSON.stringify( js_parsed );
    }

    $(document).ready(function () {

        $('#PeopleTableContainer').jtable({
            title: 'Table of people',
            actions: {
                listAction: 'crunchify/students/getall',
                createAction: function (postData) {

                    console.log('creating from custom function...');

                    var json_string = convert2jsonstring(postData);

                    return $.Deferred(function ($dfd) {

                        console.log('calling server ...');

                        $.ajax({
                            url: 'crunchify/students/append',
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            },
                            type: 'POST',
                            dataType: 'json',
                            data: json_string,
                            success: function (data) {
                                console.log('success ...');
                                $dfd.resolve(data);
                            },
                            error: function () {
                                console.log('error ...');
                                $dfd.reject();
                            }
                        });
                    });
                }

            },
            fields: {
                Name: {
                    title: 'Author Name',
                    width: '40%'
                },
                Age: {
                    title: 'Age',
                    width: '20%'
                },
                PersonId: {
                    title: 'Person Id',
                    key: true,
                    create: false,
                    edit: false,
                    list: true
                }
            }
        });

        //Load person list from server
        $('#PeopleTableContainer').jtable('load');

    });

</script>

</body>
</html>
